##DOM2和DOM3

DOM1级主要定义的是HTML和XML文档的底层结构，DOM2和DOM3在这个结构的基础上引入了更多的交互能力，也支持了更高级的XML特性

##DOM变化

###针对XML命名空间的变化

有了XML命名空间，不同XML文档就可以混合在一起，共同构成格式良好的文档，而不必担心发生命名冲突

###Node类型的变化

DOM2级中Node类型包含下列特定于命名空间的属性

|属性|解释|
|:--|---|
|localName|不带命名空间前缀的节点名称|
|namespaceURI|命名空间URI，在未指定的情况下返回NULL|
|prefix|命名空间前缀，在未指定的情况下返回NULL|

```xhtml
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>DOM_namespace</title>
	</head>
	
	<body>
		<s:svg xmlns:s="http://www.w3.org/2000/svg" version="1.1">
			
		</s:svg>
	</body>
</html>
```

对于上面代码的HTML元素来说：

|属性|值|
|:--|---|
|localName|html|
|namespaceURI|"http://www.w3.org/1999/xhtml"|
|prefix|null|
|tagName|html|

对于上面代码的svg元素来说：

|属性|值|
|:--|---|
|localName|svg|
|namespaceURI|"http://www.w3.org/2000/svg"|
|prefix|s|
|tagName|s:svg|

DOM3级在此基础上更进一步，有引入了下列与命名空间有关的方法

|属性|描述|
|:--|---|
|isdefaultNamespace(namespaceURI)|在指定的namespaceURI是当前节点的默认命名空间的情况下返回true|
|lookupNamespaceURI(prefix)|返回给定的prefix的命名空间|
|lookupPrefix(namespaceURI)|返回给定namespaceURI的前缀|

###Document类型的变化

DOM2级中的Document类型，新增了下列与命名空间有关的方法

|方法|描述|
|createElementNS(namespaceURI,tagName)|使用给定的tagName创建一个属于命名空间namespaceURI的新元素|
|createAttributeNS(namespaceURI,attributeName)|使用给定的attributeName创建一个属于命名空间namespaceURI的新特性|
|getElementByTagNameNS(namespaceURI,tagName)|返回属于命名空间的tagName元素的NodeList|

###Element类型的变化

DOM2级新增的方法：

|方法|描述|
|:--|---|
|getAttributeNS(namespaceURI,localName)|取得属性命名空间namespaceURI且名为localName的特性|
|getAttributeNodeNS(namespaceURI,localName)|取得属于命名空间namespaceURI且名为localName的特性节点|
|getElementsByTagNameNS(namespaceURI,tagName)|返回属于命名空间namespaceURI的tagName元素的NodeList|
|hasAttributeNS(namespaceURI,localName)|确定当前元素是否有一个名为localName的特性，而且该特性的命名空间是namespaceURI|
|removeAttributeNS(namespaceURI,localName)|删除属于命名空间namespaceURI且名为localName的特性|
|setAttributeNS(namespaceURI,qualifiedName,value)|设置属于命名空间namespaceURI切名为qualifiedName的特性值为value|
|setAttributeNodeNS(attNode)|设置属于命名空间namespaceURI的特性节点|

###NamedNodeMap类型变化

|方法|描述|
|getNamedItemNS(namespaceURI.localName)|取得属于命名空间namespaceURI且名为localName的项|
|removeNamedItemNS(namespaceURI.localName)|删除属于命名空间namespaceURI且名为localName的项|
|setNamedItemNS(node)|添加node，这个节点已经事先指定了命名空间信息|

###其他方面的变化

DOM的其他部分，在DOM2级核心中也发生了一些变化，这些变化与命名空间无关，而是更倾向于确保API的可靠性及完整性

###DocumentType类型

DocumentType类型新增了三个属性：publicId,systemId,internalSubset，

```html
<script type="text/javascript">
	console.log(document.doctype.publicId);//-//W3C//DTD HTML 4.01 Transitional//EN
	console.log(document.doctype.systemId);//http://www.w3.org/TR/html4/loose.dtd
</script>
```

internalSubset用于访问在文档类型声明中的额外定义

###Document类型的变化

新增方法imporNode()，从一个文档中取得一个节点，然后将其导入到另一个文档，使其成文这个文档结构的一部分

"DOM2级视图模块"，添加了defaultView属性，其中保存着一个指针，指向拥有给定文档的窗口（或框架）

	parentWindow=document.defaultView||document.parentWindow;
	document.parentWindow for IE

"DOM2级核心"为document.implementation对象新增两个新方法

	createDocumentType(文档类型名称，publicId,systemId);

```javascript
var doctype=document.implementation.createDocumentType("html","-//W3C//DTD HTML 4.01 Transitional//EN","http://www.w3.org/TR/html4/loose.dtd");
```

	createDocument(namespaceURI,文档元素的标签名，新文档的文档类型);

```javascript
var doc=document.implementation.createDocument("","root",null);
```

"DOM2级HTML"模块也为为document.implementation对象增加方法createHTMLDocument()，用来创建一个完整的HTML文档，包括html/head/title/body元素，返回新的HTML文档

```javascript
var htmldoc=document.implementation.createHTMLDocument("new Doc");
console.log(htmldoc.title);//new Doc
console.log(htmldoc.body);//object
```

通过该方法创建的文档，是HTMLDocument类型的实例，因此具有该类型所有的属性和方法，包括title和body属性

Opera和Safari支持这个方法

###Node类型的变化

新增isSupported(特性名，版本号)方法，用于确定当前节点具有什么能力

	if(document.body.isSupported("HTML","2.0")){
		console.log("HTML 2.0 is support");
	}

DOM3级新增节点比较方法isSameNode()和isEqualNode()，isSameNode()，传入节点与引用节点相同（两个节点引用的是同一个对象）的时候返回true，isEqualNode()传入的节点与引用的节点相等（两个节点是相同的类型，具有相等的属性，比如nodeName,nodeValue等等）的时候返回true

```javascript
var div1=document.createElement("div");
div1.setAttribute("class","div0");

var div2=document.createElement("div");
div2.setAttribute("class","div0");

console.log(div1.isSameNode(div1));
console.log(div1.isEqualNode(div2));
console.log(div1.isSameNode(div2));
```

DOM3级增加setUserData()，将数据指定给节点

	setUserData(要设置的键，实际数据，处理函数)

###框架的变化

##样式

任何支持style特性的HTML元素在Javascript中都有一个对应的style属性。这个style是CSSStyleDeclaration的实例，包含着通过HTML的style特性指定的所有样式信息，但不包含外部或嵌入样式表经层叠而来的样式

```
<div id="div3" style="float: left;background-color: red;">
	div3
</div>
<script type="text/javascript" >
	var div3=document.getElementById("div3");

	console.log(div3.style.backgroundColor)

	console.log(div3.style.border);//定义在style元素中的样式信息，获取不到
</script>
```

###DOM2级样式属性和方法

|属性|描述|注意|
|:--|---|---|
|cssText|访问style特性中的CSS代码|用该属性设置元素样式信息会移除元素上style属性定义的样式|
|length|应用给元素的CSS属性的数量||
|parentRule|CSS信息的CSSRule对象||
|getPropertyCSSValue(propertyName)|返回给定属性值的CSSValue对象||
|getPropertyPriority(propertyName)|如果给定的属性使用了!important设置，则返回important，否则返回空字符串||
|getpropertyValue(propertyName)|返回给定属性的字符串值||
|item(index)|返回给定位置的CSS属性名称||
|removeProperty(propertyName)||
|setProperty(propertyName,value,prrority)|将给定属性设置为相应的值，并加上优先权标志（important或者一个空字符串）||

```html
<div id="div4">
	div4
</div>
<script type="text/javascript">
	var div4=document.getElementById("div4");
	var prop,value,i,len;
	div4.style.cssText="width:250px;height:100px;background-color:blue";
	for(var i=0,len=div4.style.length;i<len;i++){
		console.log(div4.style[i]);//width, height,background-color
		//或者div4.style.item(i)
		prop=div4.style.item(i);//取得属性名
		value=div4.style.getPropertyValue(prop);//通过属性名取得属性值
		console.log(prop+":"+value);

		var CSSValue;
		// CSSValue=div4.style.getPropertyCSSValue(prop);
		// console.log(prop+":"+CSSValue);

		div4.style.removeProperty("background-color");
	}
</script>
```

**浏览器兼容：IE9+，Firefox，Safari，Opera9+，Chrome**

###计算样式

DOM2级增加getCOmputedStyle(参数，参数)方法，

参数1要取得计算样式的元素，参数2为元素字符串，如果不需要为元素可以传null，

该方法返回一个CSSStyleDeclartion对象，其中包含当前元素的所有计算样式

```html
<div id="div5" style="color: #ff0000">
	div5
</div>
<script type="text/javascript">
	var div5=document.getElementById("div5");
	var computedStyle=document.defaultView.getComputedStyle(div5,null)||;

	console.log(computedStyle.fontSize);//32px
</script>
```

###操作样式

